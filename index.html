<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="MedGemma CBM â€” Plataforma interativa de IA mÃ©dica com MedGemma 27B via Vertex AI">
    <meta name="theme-color" content="#060b18">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>MedGemma CBM â€” Plataforma de IA MÃ©dica</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Sidebar -->
    <nav id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <span class="logo-icon">ğŸ§¬</span>
                <div class="logo-text">
                    <span class="logo-title">MedGemma</span>
                    <span class="logo-sub">27B Multimodal</span>
                </div>
            </div>
        </div>

        <div class="sidebar-section">
            <span class="sidebar-section-title">Conversa</span>
            <button id="new-chat-btn" class="new-chat-btn">âœ¨ Nova Conversa</button>
            <ul class="nav-list">
                <li class="nav-item active" data-section="chat">
                    <span class="nav-icon">ğŸ’¬</span>
                    <span class="nav-label">Chat MÃ©dico</span>
                </li>
                <li class="nav-item" data-section="history">
                    <span class="nav-icon">ğŸ“œ</span>
                    <span class="nav-label">HistÃ³rico</span>
                </li>
            </ul>
            <div id="conv-list" class="conv-list"></div>
        </div>

        <div class="sidebar-section">
            <span class="sidebar-section-title">Atalhos RÃ¡pidos</span>
            <div class="quick-actions">
                <button class="quick-btn" data-command="quiz" title="Gerar quiz no chat">ğŸ§  Quiz</button>
                <button class="quick-btn" data-command="caso" title="Gerar caso clÃ­nico">ğŸ“‹ Caso ClÃ­nico</button>
                <button class="quick-btn" data-command="flashcard" title="Gerar flashcards">ğŸƒ Flashcards</button>
                <button class="quick-btn" data-command="radiologia" title="Analisar imagem">ğŸ©» Radiologia</button>
            </div>
        </div>

        <div class="sidebar-section">
            <span class="sidebar-section-title">Exames Suportados</span>
            <div class="exam-tags">
                <span class="exam-tag">ğŸ« Raio-X</span>
                <span class="exam-tag">ğŸ§  CT/MRI</span>
                <span class="exam-tag">ğŸ”¬ Histopatologia</span>
                <span class="exam-tag">ğŸ§´ Dermatologia</span>
                <span class="exam-tag">ğŸ‘ï¸ Oftalmologia</span>
                <span class="exam-tag">ğŸ“„ DICOM</span>
            </div>
        </div>

        <ul class="nav-list nav-bottom">
            <li class="nav-item" data-section="settings">
                <span class="nav-icon">âš™ï¸</span>
                <span class="nav-label">ConfiguraÃ§Ãµes</span>
            </li>
        </ul>

        <div class="sidebar-footer">
            <div id="connection-status" class="connection-badge disconnected">
                <span class="status-dot"></span>
                <span class="status-text">Offline</span>
            </div>
        </div>
    </nav>

    <!-- Mobile Header -->
    <header class="mobile-header">
        <button id="menu-toggle" class="menu-btn" aria-label="Menu">â˜°</button>
        <span class="mobile-title">ğŸ§¬ MedGemma CBM</span>
    </header>

    <!-- Main -->
    <main id="main-content" class="main-content">

        <!-- CHAT (main view) -->
        <section id="section-chat" class="section active">
            <div class="chat-container">
                <div id="chat-messages" class="chat-messages">
                    <div class="message assistant">
                        <div class="message-avatar">ğŸ§¬</div>
                        <div class="message-content">
                            <p>OlÃ¡! Sou o <strong>MedGemma 27B Multimodal</strong>. Posso te ajudar com:</p>
                            <div class="welcome-grid">
                                <div class="welcome-card" data-command="quiz">
                                    <span class="wc-icon">ğŸ§ </span>
                                    <div>
                                        <strong>Gerar Quiz</strong>
                                        <p>"FaÃ§a um quiz de cardiologia com 5 questÃµes"</p>
                                    </div>
                                </div>
                                <div class="welcome-card" data-command="caso">
                                    <span class="wc-icon">ğŸ“‹</span>
                                    <div>
                                        <strong>Caso ClÃ­nico</strong>
                                        <p>"Crie um caso clÃ­nico de emergÃªncia"</p>
                                    </div>
                                </div>
                                <div class="welcome-card" data-command="flashcard">
                                    <span class="wc-icon">ğŸƒ</span>
                                    <div>
                                        <strong>Flashcards</strong>
                                        <p>"Gere flashcards sobre antibiÃ³ticos"</p>
                                    </div>
                                </div>
                                <div class="welcome-card" data-command="radiologia">
                                    <span class="wc-icon">ğŸ©»</span>
                                    <div>
                                        <strong>Analisar Imagem</strong>
                                        <p>"Arraste um raio-X e peÃ§a para analisar"</p>
                                    </div>
                                </div>
                            </div>
                            <p style="margin-top:12px;color:var(--text-muted);font-size:0.85rem;">ğŸ’¡ Envie imagens (raio-X, CT, dermatologia, histopatologia, oftalmologia) junto com suas perguntas. MÃ¡ximo 30MB por arquivo. O modelo redimensiona para 896Ã—896px internamente.</p>
                        </div>
                    </div>
                </div>
                <div id="chat-image-preview" class="image-preview-bar hidden">
                    <div id="preview-thumbs" class="preview-thumbs"></div>
                    <button id="chat-clear-imgs" class="remove-img-btn" title="Remover todas">âœ•</button>
                </div>
                <div class="chat-input-area">
                    <label class="attach-btn" title="Anexar imagens mÃ©dicas (atÃ© 30MB cada)">
                        ğŸ“
                        <input type="file" id="chat-file-input" accept=".jpg,.jpeg,.png,.webp,.gif,.bmp,.tiff" multiple hidden>
                    </label>
                    <textarea id="chat-input" placeholder="Pergunte algo, peÃ§a um quiz, envie uma imagem..." rows="1"></textarea>
                    <button id="chat-send-btn" class="send-btn" title="Enviar">
                        <span class="send-icon">â¤</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- HISTORY -->
        <section id="section-history" class="section">
            <div class="section-header">
                <h1>ğŸ“œ HistÃ³rico de Conversas</h1>
                <p class="section-desc">Suas conversas anteriores Â· <span id="storage-count">0 conversas salvas</span></p>
                <div class="storage-badge">
                    <span class="storage-icon">ğŸ”’</span>
                    <span>Armazenamento 100% local â€” seus dados ficam <strong>apenas neste dispositivo</strong>. Nenhum dado Ã© enviado para nuvem ou servidores externos.</span>
                </div>
            </div>
            <div id="history-list" class="history-list">
                <p class="empty-state">ğŸ“­ Nenhuma conversa salva ainda. Suas conversas aparecerÃ£o aqui automaticamente.</p>
            </div>
        </section>

        <!-- SETTINGS -->
        <section id="section-settings" class="section">
            <div class="section-header">
                <h1>âš™ï¸ ConfiguraÃ§Ãµes</h1>
                <p class="section-desc">Configure a conexÃ£o com o MedGemma via Vertex AI</p>
            </div>
            <div class="settings-grid">
                <div class="settings-card">
                    <h3>ğŸ”— ConexÃ£o com Vertex AI</h3>
                    <div class="form-group">
                        <label for="set-api-base">ğŸŒ URL do Servidor API (CORS Proxy)</label>
                        <input type="text" id="set-api-base" placeholder="Ex: https://seu-app.render.com ou http://localhost:3000">
                        <small style="color:var(--text-muted);font-size:0.75rem;margin-top:4px;display:block">ObrigatÃ³rio se estiver usando via GitHub Pages ou localmente sem o Node.js.</small>
                    </div>
                    <div class="form-group">
                        <label for="set-endpoint">ğŸ“ Endpoint MedGemma (Vertex AI)</label>
                        <input type="text" id="set-endpoint" placeholder="https://{REGION}-aiplatform.googleapis.com/v1/projects/{ID}/locations/{REGION}/endpoints/{ID}">
                    </div>
                    <div class="form-group">
                        <label for="set-apikey">ğŸ”‘ AutenticaÃ§Ã£o (Bear Token/Key)</label>
                        <input type="password" id="set-apikey" placeholder="Bearer token ou API Key">
                    </div>
                    <div class="settings-actions">
                        <button id="set-save-btn" class="generate-btn">ğŸ’¾ Salvar ConfiguraÃ§Ãµes</button>
                        <button id="set-test-btn" class="generate-btn secondary">ğŸ” Testar ConexÃ£o</button>
                    </div>
                    <div id="set-status" class="set-status"></div>
                </div>
                <div class="settings-card">
                    <h3>ğŸ›ï¸ ParÃ¢metros do Modelo</h3>
                    <div class="form-group">
                        <label for="set-temperature">Temperatura: <span id="temp-value">0.3</span></label>
                        <input type="range" id="set-temperature" min="0" max="1" step="0.05" value="0.3">
                    </div>
                    <div class="form-group">
                        <label for="set-maxtokens">MÃ¡ximo de Tokens</label>
                        <select id="set-maxtokens">
                            <option value="512">512</option>
                            <option value="1024">1024</option>
                            <option value="2048" selected>2048</option>
                            <option value="4096">4096</option>
                            <option value="8192">8192</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="set-system">Prompt do Sistema</label>
                        <textarea id="set-system" rows="4" placeholder="You are a helpful medical assistant...">You are a helpful medical assistant. Sempre responda em portuguÃªs do Brasil.</textarea>
                    </div>
                </div>
                <div class="settings-card full">
                    <h3>ğŸ“– Guia RÃ¡pido de ConfiguraÃ§Ã£o</h3>
                    <div class="guide-steps">
                        <div class="guide-step"><span class="step-num">1</span><div><strong>FaÃ§a o deploy do MedGemma no Vertex AI</strong><p>Acesse o <a href="https://console.cloud.google.com/vertex-ai/publishers/google/model-garden/medgemma" target="_blank">Model Garden</a> e faÃ§a o deploy do MedGemma 27B Multimodal.</p></div></div>
                        <div class="guide-step"><span class="step-num">2</span><div><strong>Copie a URL do Endpoint</strong><p>ApÃ³s o deploy, copie a URL do endpoint gerado e cole no campo acima.</p></div></div>
                        <div class="guide-step"><span class="step-num">3</span><div><strong>AutenticaÃ§Ã£o</strong><p>Execute <code>gcloud auth application-default login</code> ou cole o access token.</p></div></div>
                        <div class="guide-step"><span class="step-num">4</span><div><strong>Pronto!</strong><p>Agora Ã© sÃ³ conversar, gerar quizzes, analisar imagens e muito mais!</p></div></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="app.js"></script>
</body>
</html>
